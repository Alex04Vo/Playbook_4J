@using WebGui.Services
@inherits LayoutComponentBase
@inject UserService UserService
@inject NavigationManager NavManager

<MudThemeProvider Theme="_myCustomTheme"/>

<MudDialogProvider
    FullWidth="true"
    CloseButton="true"
    DisableBackdropClick="true"
    Position="DialogPosition.Center"/>

<MudSnackbarProvider/>

<PageTitle>WebGui</PageTitle>

<MudLayout>
    <CustomAppBar/>
    <MudDrawer @bind-Open="@_drawerOpen" Elevation="1" Variant="@DrawerVariant.Mini"
               OpenMiniOnHover="true" ClipMode="DrawerClipMode.Always" Style="background-color: #585858">
        <MudNavMenu Dense="false" Bordered="false" Rounded="true">
            <MudNavLink Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home" IconColor="Color.Tertiary" Href="/">
                <MudText Color="Color.Tertiary" Typo="Typo.body1">Home</MudText>
            </MudNavLink>
            <MudNavLink Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.LibraryBooks" IconColor="Color.Tertiary" Href="/books/1/sections/1">
                <MudText Color="Color.Tertiary" Typo="Typo.body1">Sections</MudText>
            </MudNavLink>
            @if (UserService.CurrentUser is not null) {
                <MudNavLink Icon="@Icons.Material.Filled.Logout" IconColor="Color.Tertiary" OnClick="Logout">
                    <MudText Color="Color.Tertiary" Typo="Typo.body1">Logout</MudText>
                </MudNavLink>
            }
            else {
                <MudNavLink Icon="@Icons.Material.Filled.Login" IconColor="Color.Tertiary" OnClick="Login">
                    <MudText Color="Color.Tertiary" Typo="Typo.body1">Login</MudText>
                </MudNavLink>
            }
        </MudNavMenu>
    </MudDrawer>
    <MudMainContent>
        <MudContainer Class="py-4" MaxWidth="MaxWidth.ExtraLarge">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>


@code{

    readonly MudTheme _myCustomTheme = new MudTheme() {
        Palette = new Palette() {
            Primary = "#1259A1",
            Secondary = "#3EB3E6",
            Tertiary = "#E69E27",
            Background = "#F5F5F5"
        },
        LayoutProperties = new LayoutProperties() {
            DrawerWidthLeft = "260px",
            DrawerWidthRight = "300px"
        }
    };

    bool _drawerOpen = false;
    void DrawerToggle() {
        _drawerOpen = !_drawerOpen;
    }
    
    private async Task Logout() {
        await UserService.LogoutAsync();
        NavManager.NavigateTo($"/");
    }
    
    private void Login() {
        NavManager.NavigateTo($"/auth");
    }

}