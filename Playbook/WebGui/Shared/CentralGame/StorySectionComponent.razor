@using Model.Entities.Sections.StorySections
@using System.ComponentModel.DataAnnotations
@using Model.Entities.Outcomes.Models
@using WebGui.Services
@inject NavigationManager NavManager
@inject SessionService SessionService

@if (SessionService.CurrentSession is not null) {
    <div class="container">
        <div class="row">
            <div class="col-9">
                <MudCard>
                    <MudCardHeader>
                        <MudText Color="Color.Primary" Typo="Typo.h5">@Section.Book.Title - @Section.SectionNumber</MudText>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudText Typo="Typo.body1">@Section.Content</MudText>
                        <br/>
                        <MudDivider/>
                        <br/>
                        @foreach (var outcome in Outcomes) {
                            <div>
                                <MudButton Color="Color.Primary" Variant="Variant.Outlined" Disabled="@(!outcome.IsChooseable)"
                                           Class="m-2 w-100" OnClick="() => NavToOutcome(outcome.Outcome.Section)">
                                    @outcome.Outcome.Content - @outcome.Outcome.Section.SectionNumber
                                </MudButton>
                            </div>
                        }
                    </MudCardContent>
                </MudCard>
            </div>
            <div class="col-3">
                <GamePanelComponent Hero="SessionService.CurrentSession.Hero" />
            </div>
        </div>
    </div>
}

@code {

    [Parameter, Required]
    public StorySection Section { get; set; } = new();

    [Parameter, Required]
    public List<DisplayOutcome> Outcomes { get; set; } = new();

    private async Task NavToOutcome(StorySection goalSection) {
        await SessionService.SaveChoosenSection(Section.BookId, Section.Id, goalSection.Id);
        NavManager.NavigateTo($"/s/{SessionService.CurrentSession!.Id}/books/{Section.BookId}/sections/{goalSection.SectionNumber}");
    }
}